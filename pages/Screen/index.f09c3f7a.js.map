{"mappings":"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","sources":["node_modules/@onemorestudio/eventemitterjs/index.js","js/Socket.js","js/IFrame.js","js/Utils.js","static/config.js","pages/Screen/index.js"],"sourcesContent":["export default class EventEmitter {\n  constructor() {\n    this._events = {};\n  }\n\n  addEventListener(eventName, callback) {\n    const events = this._events;\n    const callbacks = (events[eventName] = events[eventName] || []);\n    callbacks.push(callback);\n  }\n\n  emit(eventName, args) {\n    const callbacks = this._events[eventName];\n    if (callbacks) {\n      callbacks.forEach((callback, index) => {\n        callback.apply(null, args);\n      });\n    }\n  }\n\n  removeEventListener(eventName) {\n    delete this._events[eventName];\n  }\n}\n","import EventEmitter from \"@onemorestudio/eventemitterjs\";\n\n/**\n *  IP ADDRESS TO BE CHANGED\n */\n\nexport default class Socket extends EventEmitter {\n  constructor() {\n    super();\n    this.handlers = {\n      open: this.onOpenWSConnection.bind(this),\n      error: this.onWSError.bind(this),\n      message: this.onWSMessage.bind(this),\n    };\n    this.checkWebsocketAvailibility();\n  }\n  checkWebsocketAvailibility() {\n    window.WebSocket = window.WebSocket || window.MozWebSocket;\n    // si le navigateur n'accepte pas les websocket\n    if (!window.WebSocket) {\n      alert(\"Il faut utiliser un autre navigateur. Chrome par exemple.\");\n    } else {\n      this.initConnection();\n    }\n  }\n  initConnection() {\n    this.connection = new WebSocket(`ws://${window.location.host}`);\n    // on ouvre la connection\n    this.connection.onopen = this.handlers.open;\n    this.connection.onerror = this.handlers.error;\n    this.connection.onmessage = this.handlers.message;\n  }\n  onOpenWSConnection(e) {\n    console.log(\"::open connection::\", e);\n  }\n  onWSError(error) {\n    console.log(\"::error::\", error);\n  }\n  onWSMessage(message) {\n    console.log(\"::message::\", message);\n    this.emit(\"message\", [JSON.parse(message.data)]);\n  }\n}\n","import Socket from \"./Socket\"\nimport Utils from \"./Utils\"\n\nexport default class IFrame {\n  constructor() {\n    console.log(\"iFrame is ok\")\n    this.handlers = {\n      message: this.onMessage.bind(this),\n      load: this.onIFrameLoaded.bind(this),\n    }\n    this.frame = document.getElementById(\"frame\")\n    this.frame.src = frame.src // force iframe reload\n    this.frame.addEventListener(\"load\", this.handlers.load)\n    this.socket = new Socket()\n    this.socket.addEventListener(\"message\", this.handlers.message)\n    this.initData()\n  }\n\n  async initData() {\n    this.studentsData = await Utils.loadJSON(\"/json/studentProjects.json\")\n  }\n  onIFrameLoaded(e) {\n    console.log(\"::iframe loaded::\", e)\n    this.onFrameLoad(e);\n  }\n\n  onMessage(data) {\n    if (\"project_id\" in data) {\n      const id = parseInt(data[\"project_id\"])\n      const url = this.studentsData.projects[id].url\n      this.frame.src = url + `?_v=${new Date().getTime()}`\n    }\n  }\n  // overwritten\n  onFrameLoad(event) {}\n}\n","export default class Utils {\n  constructor() {}\n  static loadJSON(url) {\n    return fetch(url)\n      .then((data) => data.json())\n      .then((json) => json);\n  }\n}\n","export default Object.freeze({\n    smoothenDetection: 0.5, //? between 0 and 1, 0 is no smoothing\n    cameraConstraints: {\n        audio: false,\n        video: true,\n        // video: {\n        //     deviceId: \"977315e0713f6d873c7028ba8221c652a0fcb866e151903ccd95efd5371153b3\"\n        // }\n    },\n\n    mediaPipeOptions: {\n        selfieMode: false,\n        modelComplexity: 1,\n        smoothLandmarks: true,\n        enableSegmentation: false,\n        smoothSegmentation: true,\n        minDetectionConfidence: 0.5,\n        minTrackingConfidence: 0.5,\n    }\n})","import \"~/styles/iframe.scss\"\nimport IFrame from \"~/js/IFrame\"\n\nimport CONFIG from \"~/static/config.js\"\n\nimport { MediaPipePose } from '@ecal-mid/mediapipe'\n\n// hack parcel..\n\nwindow.onload = async () => {\n\n  // await loadMediapipe\n  const pose = await MediaPipePose.create({\n    cameraConstraints: CONFIG.cameraConstraints,\n    mediaPipeOptions: CONFIG.mediaPipeOptions,\n    smoothen: CONFIG.smoothenDetection\n  })\n\n  const player = pose.getVideoPlayer()\n  pose.startDetection()\n\n  const frame = new IFrame()\n\n  frame.onFrameLoad = (event) => insertIFrame({ player, iframe: event.target, pose })\n\n  const overlayFrame = document.querySelector('#overlay')\n  overlayFrame.onload = (event) => insertIFrame({ player, iframe: event.target, pose })\n  overlayFrame.src = '/pages/ExpoOverlay'\n}\n\nfunction insertIFrame({ player, pose, iframe }) {\n  const mediaPipe = iframe.contentWindow?.mediaPipe\n  console.log(mediaPipe)\n  if (!mediaPipe) return\n  mediaPipe.setup({ stream: player.stream, width: player.width, height: player.height, pose })\n}"],"names":["this","_events","addEventListener","eventName","callback","events","push","emit","args","callbacks","forEach","index","apply","removeEventListener","super","handlers","open","onOpenWSConnection","bind","error","onWSError","message","onWSMessage","checkWebsocketAvailibility","window","WebSocket","MozWebSocket","initConnection","alert","connection","location","host","onopen","onerror","onmessage","e","console","log","JSON","parse","data","onMessage","load","onIFrameLoaded","frame","document","getElementById","src","socket","$f35ebd97440e418b$export$2e2bcd8739ae039","initData","studentsData","url","fetch","then","json","loadJSON","onFrameLoad","id","parseInt","projects","Date","getTime","event","$1eb196c69397253e$export$2e2bcd8739ae039","Object","freeze","smoothenDetection","cameraConstraints","audio","video","mediaPipeOptions","selfieMode","modelComplexity","smoothLandmarks","enableSegmentation","smoothSegmentation","minDetectionConfidence","minTrackingConfidence","$22cd6ccddc8d4999$var$insertIFrame","player","pose","iframe","mediaPipe","contentWindow","setup","stream","width","height","onload","async","$hARZV","MediaPipePose","create","smoothen","getVideoPlayer","startDetection","$e1d13788db9269db$export$2e2bcd8739ae039","target","overlayFrame","querySelector"],"version":3,"file":"index.f09c3f7a.js.map"}